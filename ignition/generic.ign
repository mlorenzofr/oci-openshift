{
  "ignition": {
    "version": "3.1.0"
  },
  "passwd": {
    "users": [
      {"groups":["sudo"],"name":"core","passwordHash":"<redacted>","sshAuthorizedKeys":["ssh-rsa ....."]}
    ]
  },
  "systemd": {
    "units": [{
      "name": "agent.service",
      "enabled": true,
      "contents": "[Service]\nType=simple\nRestart=always\nRestartSec=3\nStartLimitInterval=0\nEnvironment=HTTP_PROXY=\nEnvironment=http_proxy=\nEnvironment=HTTPS_PROXY=\nEnvironment=https_proxy=\nEnvironment=NO_PROXY=\nEnvironment=no_proxy=\nEnvironmentFile=/etc/agent.env\nTimeoutStartSec=1800\nExecStartPre=/usr/local/bin/agent-fix-bz1964591 registry.redhat.io/rhai/assisted-installer-agent-rhel9:8266f8816db76d47dff55ad2e319093eddccc6e7\nExecStartPre=podman run --privileged --rm -v /usr/local/bin:/hostbin registry.redhat.io/rhai/assisted-installer-agent-rhel9:8266f8816db76d47dff55ad2e319093eddccc6e7 cp /usr/bin/agent /hostbin\nExecStart=/usr/local/bin/agent --url https://api.openshift.com --infra-env-id ${INFRAENV_ID} --agent-version registry.redhat.io/rhai/assisted-installer-agent-rhel9:8266f8816db76d47dff55ad2e319093eddccc6e7 --insecure=false  \n\n[Unit]\nWants=network-online.target\nAfter=network-online.target\nWants=oci-eval-user-data.service\nAfter=oci-eval-user-data.service\nConditionPathExists=/etc/agent.env\n\n[Install]\nWantedBy=multi-user.target\n"
    },
    {
        "name": "selinux.service",
        "enabled": true,
        "contents": "[Service]\nType=oneshot\nExecStartPre=checkmodule -M -m -o /root/assisted.mod /root/assisted.te\nExecStartPre=semodule_package -o /root/assisted.pp -m /root/assisted.mod\nExecStart=semodule -i /root/assisted.pp\n\n[Install]\nWantedBy=multi-user.target\n"
    },
    {
        "name": "multipathd.service",
        "enabled": true
    },
    {
        "name": "iscsistart.service",
        "enabled": true,
        "contents": "[Service]\nType=oneshot\nExecStartPre=-/usr/sbin/modprobe iscsi_ibft\nExecStartPre=-/usr/sbin/iscsistart -f\nExecStart=-/usr/sbin/iscsistart -b\n\n[Install]\nWantedBy=multi-user.target\n"
    },
    {
        "name": "oci-eval-user-data.service",
        "enabled": true,
        "contents": "[Unit]\nDescription=Pull a script passed in OCI user data and execute it\nAfter=NetworkManager.service\n\n[Service]\nStandardOutput=syslog\nStandardError=syslog\nEnvironment=\"ASSISTED_INSTALLER_DISCOVERY_ENV=1\"\nExecStart=/usr/local/bin/oci-eval-user-data.sh\nType=oneshot\nRemainAfterExit=yes\nRestart=on-failure\nRestartSec=30\n\n[Install]\nWantedBy=multi-user.target\n"
    }
    ]
  },
  "storage": {
    "files": [{
      "overwrite": true,
      "path": "/usr/local/bin/agent-fix-bz1964591",
      "mode": 493,
      "user": {
          "name": "root"
      },
      "contents": { "source": "data:,%23%21%2Fusr%2Fbin%2Fsh%0A%0A%23%20This%20script%20is%20a%20workaround%20for%20bugzilla%201964591%20where%20symlinks%20inside%20%2Fvar%2Flib%2Fcontainers%2F%20get%0A%23%20corrupted%20under%20some%20circumstances.%0A%23%0A%23%20In%20order%20to%20let%20agent.service%20start%20correctly%20we%20are%20checking%20here%20whether%20the%20requested%0A%23%20container%20image%20exists%20and%20in%20case%20%22podman%20images%22%20returns%20an%20error%20we%20try%20removing%20the%20faulty%0A%23%20image.%0A%23%0A%23%20In%20such%20a%20scenario%20agent.service%20will%20detect%20the%20image%20is%20not%20present%20and%20pull%20it%20again.%20In%20case%0A%23%20the%20image%20is%20present%20and%20can%20be%20detected%20correctly%2C%20no%20any%20action%20is%20required.%0A%0AIMAGE=$%28echo%20$1%20%7C%20sed%20%27s%2F%5B@:%5D.%2A%2F%2F%27%29%0Apodman%20images%20%7C%20grep%20$IMAGE%20%7C%7C%20podman%20rmi%20--force%20$1%20%7C%7C%20true%0A" }
    },
    {
      "overwrite": true,
      "path": "/etc/motd",
      "mode": 420,
      "user": {
          "name": "root"
      },
      "contents": { "source": "data:,%0A%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%0AThis%20is%20a%20host%20being%20installed%20by%20the%20OpenShift%20Assisted%20Installer.%0AIt%20will%20be%20installed%20from%20scratch%20during%20the%20installation.%0A%0AThe%20primary%20service%20is%20agent.service.%20To%20watch%20its%20status%2C%20run:%0Asudo%20journalctl%20-u%20agent.service%0A%0ATo%20view%20the%20agent%20log%2C%20run:%0Asudo%20journalctl%20TAG=agent%0A%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%20%20%2A%2A%0A" }
    },
    {
      "overwrite": true,
      "path": "/etc/multipath.conf",
      "mode": 420,
      "user": {
          "name": "root"
      },
      "contents": { "source": "data:text/plain;charset=utf-8;base64,ZGVmYXVsdHMgewogICAgdXNlcl9mcmllbmRseV9uYW1lcyB5ZXMKICAgIGZpbmRfbXVsdGlwYXRocyB5ZXMKICAgIGVuYWJsZV9mb3JlaWduICJeJCIKfQpibGFja2xpc3RfZXhjZXB0aW9ucyB7CiAgICBwcm9wZXJ0eSAiKFNDU0lfSURFTlRffElEX1dXTikiCn0KYmxhY2tsaXN0IHsKfQ==" }
    },
    {
      "path": "/usr/local/bin/oci-eval-user-data.sh",
      "mode": 493,
      "user": {
        "name": "root"
      },
      "contents": { "source": "data:text/plain;charset=utf-8;base64,IyEvdXNyL2Jpbi9lbnYgYmFzaAoKc2V0IC1ldXhvIHBpcGVmYWlsCgpjaGFzc2lzX2Fzc2V0X3RhZz0iJChkbWlkZWNvZGUgLS1zdHJpbmcgY2hhc3Npcy1hc3NldC10YWcpIgppZiBbICIke2NoYXNzaXNfYXNzZXRfdGFnfSIgIT0gIk9yYWNsZUNsb3VkLmNvbSIgXQp0aGVuCiAgZWNobyAiTm90IHJ1bm5pbmcgaW4gT3JhY2xlIENsb3VkIEluZnJhc3RydWN0dXJlLiBTa2lwcGluZy4iCiAgZXhpdCAwCmZpCgppZiAhIHVzZXJfZGF0YV9iNjQ9JChjdXJsIC1IICJBdXRob3JpemF0aW9uOiBCZWFyZXIgT3JhY2xlIiAtLW1heC10aW1lIDMwIC0tcmV0cnkgNSAtLXJldHJ5LWRlbGF5IDMwIC0tcmV0cnktY29ubnJlZnVzZWQgLUwgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9vcGMvdjIvaW5zdGFuY2UvbWV0YWRhdGEvdXNlcl9kYXRhKQp0aGVuCiAgZWNobyAiRmFpbGVkIHRvIHJldHJpZXZlIHVzZXIgZGF0YSBmcm9tIGluc3RhbmNlIG1ldGFkYXRhIgogIGV4aXQgMQpmaQoKaWYgZ3JlcCAtcSAiNDA0IE5vdCBGb3VuZCIgPDw8ICIke3VzZXJfZGF0YV9iNjR9Igp0aGVuCiAgZWNobyAiTm8gdXNlciBkYXRhIGF2YWlsYWJsZSIKICBleGl0IDAKZmkKCmlmICEgdXNlcl9kYXRhPSQoZWNobyAtbiAiJHt1c2VyX2RhdGFfYjY0fSIgfCBiYXNlNjQgLS1kZWNvZGUpCnRoZW4KICBlY2hvICJGYWlsZWQgdG8gZGVjb2RlIHVzZXIgZGF0YSIKICBleGl0IDEKZmkKCmJhc2ggPChlY2hvICIke3VzZXJfZGF0YX0iKQo=" }
    },
    {
      "overwrite": true,
      "path": "/etc/NetworkManager/conf.d/01-ipv6.conf",
      "mode": 420,
      "user": {
          "name": "root"
      },
      "contents": { "source": "data:,%0A%5Bconnection%5D%0Aipv6.dhcp-iaid=mac%0Aipv6.dhcp-duid=ll%0A" }
    },
    {
        "overwrite": true,
        "path": "/root/assisted.te",
        "mode": 420,
        "user": {
            "name": "root"
        },
        "contents": { "source": "data:text/plain;base64,Cm1vZHVsZSBhc3Npc3RlZCAxLjA7CnJlcXVpcmUgewogICAgICAgIHR5cGUgY2hyb255ZF90OwogICAgICAgIHR5cGUgY29udGFpbmVyX2ZpbGVfdDsKICAgICAgICB0eXBlIHNwY190OwogICAgICAgIGNsYXNzIHVuaXhfZGdyYW1fc29ja2V0IHNlbmR0bzsKICAgICAgICBjbGFzcyBkaXIgc2VhcmNoOwogICAgICAgIGNsYXNzIHNvY2tfZmlsZSB3cml0ZTsKfQojPT09PT09PT09PT09PSBjaHJvbnlkX3QgPT09PT09PT09PT09PT0KYWxsb3cgY2hyb255ZF90IGNvbnRhaW5lcl9maWxlX3Q6ZGlyIHNlYXJjaDsKYWxsb3cgY2hyb255ZF90IGNvbnRhaW5lcl9maWxlX3Q6c29ja19maWxlIHdyaXRlOwphbGxvdyBjaHJvbnlkX3Qgc3BjX3Q6dW5peF9kZ3JhbV9zb2NrZXQgc2VuZHRvOwo=" }
    }]
  }
}
